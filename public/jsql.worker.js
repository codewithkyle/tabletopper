(()=>{var Ne=(i,e)=>e.some(t=>i instanceof t),re,ie;function Oe(){return re||(re=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Re(){return ie||(ie=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ae=new WeakMap,B=new WeakMap,oe=new WeakMap,F=new WeakMap,Q=new WeakMap;function je(i){let e=new Promise((t,n)=>{let s=()=>{i.removeEventListener("success",r),i.removeEventListener("error",a)},r=()=>{t(M(i.result)),s()},a=()=>{n(i.error),s()};i.addEventListener("success",r),i.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&ae.set(t,i)}).catch(()=>{}),Q.set(e,i),e}function Pe(i){if(B.has(i))return;let e=new Promise((t,n)=>{let s=()=>{i.removeEventListener("complete",r),i.removeEventListener("error",a),i.removeEventListener("abort",a)},r=()=>{t(),s()},a=()=>{n(i.error||new DOMException("AbortError","AbortError")),s()};i.addEventListener("complete",r),i.addEventListener("error",a),i.addEventListener("abort",a)});B.set(i,e)}var W={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return B.get(i);if(e==="objectStoreNames")return i.objectStoreNames||oe.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return M(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function De(i){W=i(W)}function _e(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let n=i.call(V(this),e,...t);return oe.set(n,e.sort?e.sort():[e]),M(n)}:Re().includes(i)?function(...e){return i.apply(V(this),e),M(ae.get(this))}:function(...e){return M(i.apply(V(this),e))}}function $e(i){return typeof i=="function"?_e(i):(i instanceof IDBTransaction&&Pe(i),Ne(i,Oe())?new Proxy(i,W):i)}function M(i){if(i instanceof IDBRequest)return je(i);if(F.has(i))return F.get(i);let e=$e(i);return e!==i&&(F.set(i,e),Q.set(e,i)),e}var V=i=>Q.get(i);function ce(i,e,{blocked:t,upgrade:n,blocking:s,terminated:r}={}){let a=indexedDB.open(i,e),o=M(a);return n&&a.addEventListener("upgradeneeded",c=>{n(M(a.result),c.oldVersion,c.newVersion,M(a.transaction))}),t&&a.addEventListener("blocked",()=>t()),o.then(c=>{r&&c.addEventListener("close",()=>r()),s&&c.addEventListener("versionchange",()=>s())}).catch(()=>{}),o}var Ue=["get","getKey","getAll","getAllKeys","count"],Be=["put","add","delete","clear"],K=new Map;function le(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(K.get(e))return K.get(e);let t=e.replace(/FromIndex$/,""),n=e!==t,s=Be.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Ue.includes(t)))return;let r=async function(a,...o){let c=this.transaction(a,s?"readwrite":"readonly"),l=c.store;return n&&(l=l.index(o.shift())),(await Promise.all([l[t](...o),s&&c.done]))[0]};return K.set(e,r),r}De(i=>({...i,get:(e,t,n)=>le(e,t)||i.get(e,t,n),has:(e,t)=>!!le(e,t)||i.has(e,t)}));function S(i){return Array.isArray?Array.isArray(i):fe(i)==="[object Array]"}var Fe=1/0;function Qe(i){if(typeof i=="string")return i;let e=i+"";return e=="0"&&1/i==-Fe?"-0":e}function We(i){return i==null?"":Qe(i)}function v(i){return typeof i=="string"}function he(i){return typeof i=="number"}function Ve(i){return i===!0||i===!1||Ke(i)&&fe(i)=="[object Boolean]"}function ue(i){return typeof i=="object"}function Ke(i){return ue(i)&&i!==null}function y(i){return i!=null}function G(i){return!i.trim().length}function fe(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}var Ge="Incorrect 'index' type",He=i=>`Invalid value for key ${i}`,Ye=i=>`Pattern length exceeds max of ${i}.`,Xe=i=>`Missing ${i} property in key`,ze=i=>`Property 'weight' in key '${i}' must be a positive integer`,de=Object.prototype.hasOwnProperty,pe=class{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(n=>{let s=ge(n);t+=s.weight,this._keys.push(s),this._keyMap[s.id]=s,t+=s.weight}),this._keys.forEach(n=>{n.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function ge(i){let e=null,t=null,n=null,s=1;if(v(i)||S(i))n=i,e=be(i),t=H(i);else{if(!de.call(i,"name"))throw new Error(Xe("name"));let r=i.name;if(n=r,de.call(i,"weight")&&(s=i.weight,s<=0))throw new Error(ze(r));e=be(r),t=H(r)}return{path:e,id:t,weight:s,src:n}}function be(i){return S(i)?i:i.split(".")}function H(i){return S(i)?i.join("."):i}function Je(i,e){let t=[],n=!1,s=(r,a,o)=>{if(!!y(r))if(!a[o])t.push(r);else{let c=a[o],l=r[c];if(!y(l))return;if(o===a.length-1&&(v(l)||he(l)||Ve(l)))t.push(We(l));else if(S(l)){n=!0;for(let h=0,u=l.length;h<u;h+=1)s(l[h],a,o+1)}else a.length&&s(l,a,o+1)}};return s(i,v(e)?e.split("."):e,0),n?t:t[0]}var Ze={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},qe={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(i,e)=>i.score===e.score?i.idx<e.idx?-1:1:i.score<e.score?-1:1},et={location:0,threshold:.6,distance:100},tt={useExtendedSearch:!1,getFn:Je,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},d={...qe,...Ze,...et,...tt},nt=/[^ ]+/g;function st(i=1,e=3){let t=new Map,n=Math.pow(10,e);return{get(s){let r=s.match(nt).length;if(t.has(r))return t.get(r);let a=1/Math.pow(r,.5*i),o=parseFloat(Math.round(a*n)/n);return t.set(r,o),o},clear(){t.clear()}}}var P=class{constructor({getFn:e=d.getFn,fieldNormWeight:t=d.fieldNormWeight}={}){this.norm=st(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,n)=>{this._keysMap[t.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,v(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){let t=this.size();v(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,n=this.size();t<n;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!y(e)||G(e))return;let n={v:e,i:t,n:this.norm.get(e)};this.records.push(n)}_addObject(e,t){let n={i:t,$:{}};this.keys.forEach((s,r)=>{let a=this.getFn(e,s.path);if(!!y(a)){if(S(a)){let o=[],c=[{nestedArrIndex:-1,value:a}];for(;c.length;){let{nestedArrIndex:l,value:h}=c.pop();if(!!y(h))if(v(h)&&!G(h)){let u={v:h,i:l,n:this.norm.get(h)};o.push(u)}else S(h)&&h.forEach((u,f)=>{c.push({nestedArrIndex:f,value:u})})}n.$[r]=o}else if(!G(a)){let o={v:a,n:this.norm.get(a)};n.$[r]=o}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}};function ye(i,e,{getFn:t=d.getFn,fieldNormWeight:n=d.fieldNormWeight}={}){let s=new P({getFn:t,fieldNormWeight:n});return s.setKeys(i.map(ge)),s.setSources(e),s.create(),s}function rt(i,{getFn:e=d.getFn,fieldNormWeight:t=d.fieldNormWeight}={}){let{keys:n,records:s}=i,r=new P({getFn:e,fieldNormWeight:t});return r.setKeys(n),r.setIndexRecords(s),r}function D(i,{errors:e=0,currentLocation:t=0,expectedLocation:n=0,distance:s=d.distance,ignoreLocation:r=d.ignoreLocation}={}){let a=e/i.length;if(r)return a;let o=Math.abs(n-t);return s?a+o/s:o?1:a}function it(i=[],e=d.minMatchCharLength){let t=[],n=-1,s=-1,r=0;for(let a=i.length;r<a;r+=1){let o=i[r];o&&n===-1?n=r:!o&&n!==-1&&(s=r-1,s-n+1>=e&&t.push([n,s]),n=-1)}return i[r-1]&&r-n>=e&&t.push([n,r-1]),t}var L=32;function at(i,e,t,{location:n=d.location,distance:s=d.distance,threshold:r=d.threshold,findAllMatches:a=d.findAllMatches,minMatchCharLength:o=d.minMatchCharLength,includeMatches:c=d.includeMatches,ignoreLocation:l=d.ignoreLocation}={}){if(e.length>L)throw new Error(Ye(L));let h=e.length,u=i.length,f=Math.max(0,Math.min(n,u)),p=r,g=f,b=o>1||c,C=b?Array(u):[],I;for(;(I=i.indexOf(e,g))>-1;){let m=D(e,{currentLocation:I,expectedLocation:f,distance:s,ignoreLocation:l});if(p=Math.min(m,p),g=I+h,b){let A=0;for(;A<h;)C[I+A]=1,A+=1}}g=-1;let N=[],T=1,R=h+u,Le=1<<h-1;for(let m=0;m<h;m+=1){let A=0,k=R;for(;A<k;)D(e,{errors:m,currentLocation:f+k,expectedLocation:f,distance:s,ignoreLocation:l})<=p?A=k:R=k,k=Math.floor((R-A)/2+A);R=k;let ne=Math.max(1,f-k+1),U=a?u:Math.min(f+k,u)+h,O=Array(U+2);O[U+1]=(1<<m)-1;for(let E=U;E>=ne;E-=1){let j=E-1,se=t[i.charAt(j)];if(b&&(C[j]=+!!se),O[E]=(O[E+1]<<1|1)&se,m&&(O[E]|=(N[E+1]|N[E])<<1|1|N[E+1]),O[E]&Le&&(T=D(e,{errors:m,currentLocation:j,expectedLocation:f,distance:s,ignoreLocation:l}),T<=p)){if(p=T,g=j,g<=f)break;ne=Math.max(1,2*f-g)}}if(D(e,{errors:m+1,currentLocation:f,expectedLocation:f,distance:s,ignoreLocation:l})>p)break;N=O}let $={isMatch:g>=0,score:Math.max(.001,T)};if(b){let m=it(C,o);m.length?c&&($.indices=m):$.isMatch=!1}return $}function ot(i){let e={};for(let t=0,n=i.length;t<n;t+=1){let s=i.charAt(t);e[s]=(e[s]||0)|1<<n-t-1}return e}var Y=class{constructor(e,{location:t=d.location,threshold:n=d.threshold,distance:s=d.distance,includeMatches:r=d.includeMatches,findAllMatches:a=d.findAllMatches,minMatchCharLength:o=d.minMatchCharLength,isCaseSensitive:c=d.isCaseSensitive,ignoreLocation:l=d.ignoreLocation}={}){if(this.options={location:t,threshold:n,distance:s,includeMatches:r,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:c,ignoreLocation:l},this.pattern=c?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;let h=(f,p)=>{this.chunks.push({pattern:f,alphabet:ot(f),startIndex:p})},u=this.pattern.length;if(u>L){let f=0,p=u%L,g=u-p;for(;f<g;)h(this.pattern.substr(f,L),f),f+=L;if(p){let b=u-L;h(this.pattern.substr(b),b)}}else h(this.pattern,0)}searchIn(e){let{isCaseSensitive:t,includeMatches:n}=this.options;if(t||(e=e.toLowerCase()),this.pattern===e){let g={isMatch:!0,score:0};return n&&(g.indices=[[0,e.length-1]]),g}let{location:s,distance:r,threshold:a,findAllMatches:o,minMatchCharLength:c,ignoreLocation:l}=this.options,h=[],u=0,f=!1;this.chunks.forEach(({pattern:g,alphabet:b,startIndex:C})=>{let{isMatch:I,score:N,indices:T}=at(e,g,b,{location:s+C,distance:r,threshold:a,findAllMatches:o,minMatchCharLength:c,includeMatches:n,ignoreLocation:l});I&&(f=!0),u+=N,I&&T&&(h=[...h,...T])});let p={isMatch:f,score:f?u/this.chunks.length:1};return f&&n&&(p.indices=h),p}},w=class{constructor(e){this.pattern=e}static isMultiMatch(e){return me(e,this.multiRegex)}static isSingleMatch(e){return me(e,this.singleRegex)}search(){}};function me(i,e){let t=i.match(e);return t?t[1]:null}var Ee=class extends w{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){let t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},Ie=class extends w{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){let n=e.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}},Se=class extends w{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){let t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},ve=class extends w{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){let t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},we=class extends w{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){let t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},Ae=class extends w{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){let t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},X=class extends w{constructor(e,{location:t=d.location,threshold:n=d.threshold,distance:s=d.distance,includeMatches:r=d.includeMatches,findAllMatches:a=d.findAllMatches,minMatchCharLength:o=d.minMatchCharLength,isCaseSensitive:c=d.isCaseSensitive,ignoreLocation:l=d.ignoreLocation}={}){super(e);this._bitapSearch=new Y(e,{location:t,threshold:n,distance:s,includeMatches:r,findAllMatches:a,minMatchCharLength:o,isCaseSensitive:c,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}},z=class extends w{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,n,s=[],r=this.pattern.length;for(;(n=e.indexOf(this.pattern,t))>-1;)t=n+r,s.push([n,t-1]);let a=!!s.length;return{isMatch:a,score:a?0:1,indices:s}}},J=[Ee,z,Se,ve,Ae,we,Ie,X],ke=J.length,ct=/ +(?=([^\"]*\"[^\"]*\")*[^\"]*$)/,lt="|";function ht(i,e={}){return i.split(lt).map(t=>{let n=t.trim().split(ct).filter(r=>r&&!!r.trim()),s=[];for(let r=0,a=n.length;r<a;r+=1){let o=n[r],c=!1,l=-1;for(;!c&&++l<ke;){let h=J[l],u=h.isMultiMatch(o);u&&(s.push(new h(u,e)),c=!0)}if(!c)for(l=-1;++l<ke;){let h=J[l],u=h.isSingleMatch(o);if(u){s.push(new h(u,e));break}}}return s})}var ut=new Set([X.type,z.type]),Me=class{constructor(e,{isCaseSensitive:t=d.isCaseSensitive,includeMatches:n=d.includeMatches,minMatchCharLength:s=d.minMatchCharLength,ignoreLocation:r=d.ignoreLocation,findAllMatches:a=d.findAllMatches,location:o=d.location,threshold:c=d.threshold,distance:l=d.distance}={}){this.query=null,this.options={isCaseSensitive:t,includeMatches:n,minMatchCharLength:s,findAllMatches:a,ignoreLocation:r,location:o,threshold:c,distance:l},this.pattern=t?e:e.toLowerCase(),this.query=ht(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){let t=this.query;if(!t)return{isMatch:!1,score:1};let{includeMatches:n,isCaseSensitive:s}=this.options;e=s?e:e.toLowerCase();let r=0,a=[],o=0;for(let c=0,l=t.length;c<l;c+=1){let h=t[c];a.length=0,r=0;for(let u=0,f=h.length;u<f;u+=1){let p=h[u],{isMatch:g,indices:b,score:C}=p.search(e);if(g){if(r+=1,o+=C,n){let I=p.constructor.type;ut.has(I)?a=[...a,...b]:a.push(b)}}else{o=0,r=0,a.length=0;break}}if(r){let u={isMatch:!0,score:o/r};return n&&(u.indices=a),u}}return{isMatch:!1,score:1}}},Z=[];function ft(...i){Z.push(...i)}function q(i,e){for(let t=0,n=Z.length;t<n;t+=1){let s=Z[t];if(s.condition(i,e))return new s(i,e)}return new Y(i,e)}var _={AND:"$and",OR:"$or"},ee={PATH:"$path",PATTERN:"$val"},te=i=>!!(i[_.AND]||i[_.OR]),dt=i=>!!i[ee.PATH],pt=i=>!S(i)&&ue(i)&&!te(i),xe=i=>({[_.AND]:Object.keys(i).map(e=>({[e]:i[e]}))});function Ce(i,e,{auto:t=!0}={}){let n=s=>{let r=Object.keys(s),a=dt(s);if(!a&&r.length>1&&!te(s))return n(xe(s));if(pt(s)){let c=a?s[ee.PATH]:r[0],l=a?s[ee.PATTERN]:s[c];if(!v(l))throw new Error(He(c));let h={keyId:H(c),pattern:l};return t&&(h.searcher=q(l,e)),h}let o={children:[],operator:r[0]};return r.forEach(c=>{let l=s[c];S(l)&&l.forEach(h=>{o.children.push(n(h))})}),o};return te(i)||(i=xe(i)),n(i)}function gt(i,{ignoreFieldNorm:e=d.ignoreFieldNorm}){i.forEach(t=>{let n=1;t.matches.forEach(({key:s,norm:r,score:a})=>{let o=s?s.weight:null;n*=Math.pow(a===0&&o?Number.EPSILON:a,(o||1)*(e?1:r))}),t.score=n})}function bt(i,e){let t=i.matches;e.matches=[],!!y(t)&&t.forEach(n=>{if(!y(n.indices)||!n.indices.length)return;let{indices:s,value:r}=n,a={indices:s,value:r};n.key&&(a.key=n.key.src),n.idx>-1&&(a.refIndex=n.idx),e.matches.push(a)})}function yt(i,e){e.score=i.score}function mt(i,e,{includeMatches:t=d.includeMatches,includeScore:n=d.includeScore}={}){let s=[];return t&&s.push(bt),n&&s.push(yt),i.map(r=>{let{idx:a}=r,o={item:e[a],refIndex:a};return s.length&&s.forEach(c=>{c(r,o)}),o})}var x=class{constructor(e,t={},n){this.options={...d,...t},this.options.useExtendedSearch,this._keyStore=new pe(this.options.keys),this.setCollection(e,n)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof P))throw new Error(Ge);this._myIndex=t||ye(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){!y(e)||(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){let t=[];for(let n=0,s=this._docs.length;n<s;n+=1){let r=this._docs[n];e(r,n)&&(this.removeAt(n),n-=1,s-=1,t.push(r))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){let{includeMatches:n,includeScore:s,shouldSort:r,sortFn:a,ignoreFieldNorm:o}=this.options,c=v(e)?v(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return gt(c,{ignoreFieldNorm:o}),r&&c.sort(a),he(t)&&t>-1&&(c=c.slice(0,t)),mt(c,this._docs,{includeMatches:n,includeScore:s})}_searchStringList(e){let t=q(e,this.options),{records:n}=this._myIndex,s=[];return n.forEach(({v:r,i:a,n:o})=>{if(!y(r))return;let{isMatch:c,score:l,indices:h}=t.searchIn(r);c&&s.push({item:r,idx:a,matches:[{score:l,value:r,norm:o,indices:h}]})}),s}_searchLogical(e){let t=Ce(e,this.options),n=(o,c,l)=>{if(!o.children){let{keyId:u,searcher:f}=o,p=this._findMatches({key:this._keyStore.get(u),value:this._myIndex.getValueForItemAtKeyId(c,u),searcher:f});return p&&p.length?[{idx:l,item:c,matches:p}]:[]}let h=[];for(let u=0,f=o.children.length;u<f;u+=1){let p=o.children[u],g=n(p,c,l);if(g.length)h.push(...g);else if(o.operator===_.AND)return[]}return h},s=this._myIndex.records,r={},a=[];return s.forEach(({$:o,i:c})=>{if(y(o)){let l=n(t,o,c);l.length&&(r[c]||(r[c]={idx:c,item:o,matches:[]},a.push(r[c])),l.forEach(({matches:h})=>{r[c].matches.push(...h)}))}}),a}_searchObjectList(e){let t=q(e,this.options),{keys:n,records:s}=this._myIndex,r=[];return s.forEach(({$:a,i:o})=>{if(!y(a))return;let c=[];n.forEach((l,h)=>{c.push(...this._findMatches({key:l,value:a[h],searcher:t}))}),c.length&&r.push({idx:o,item:a,matches:c})}),r}_findMatches({key:e,value:t,searcher:n}){if(!y(t))return[];let s=[];if(S(t))t.forEach(({v:r,i:a,n:o})=>{if(!y(r))return;let{isMatch:c,score:l,indices:h}=n.searchIn(r);c&&s.push({score:l,key:e,value:r,idx:a,norm:o,indices:h})});else{let{v:r,n:a}=t,{isMatch:o,score:c,indices:l}=n.searchIn(r);o&&s.push({score:c,key:e,value:r,norm:a,indices:l})}return s}};x.version="6.5.3";x.createIndex=ye;x.parseIndex=rt;x.config=d;x.parseQuery=Ce;ft(Me);var Te=class{constructor(){this.db=null,this.tables=null,this.defaults={},self.onmessage=this.inbox.bind(this)}async inbox(e){let{type:t,uid:n,data:s}=e.data,r=s?.debug??!1;try{let a=null;switch(t){case"init":a=await this.init(s);break;case"query":let o=[];Array.isArray(s)?o=s:o=[s],a=await this.performQuery(o,r);break;case"sql":let c=await this.buildQueriesFromSQL(s);a=await this.performQuery(c,r);break;default:console.warn(`Invalid JSQL Worker message type: ${t}`);break}this.send("response",a,n)}catch(a){s?.sql?.length&&(a=`${a} (${s.sql})`),this.send("error",a,n)}}send(e,t=null,n=null,s=null){let r={type:e,data:t,uid:n};s?self.postMessage(r,s):self.postMessage(r)}async init({schema:e,currentVersion:t}){let n;if(typeof e=="string"){let a=await fetch(e,{method:"GET",headers:new Headers({Accept:"application/json"}),credentials:"include"});if(!a.ok)throw`${a.status}: ${a.statusText}`;n=await a.json()}else n=e;this.tables=n.tables;for(let a=0;a<this.tables.length;a++){let o=this.tables[a],c={};for(let l=0;l<o.columns.length;l++)c[o.columns[l].key]=o.columns[l]?.default??null;this.defaults[o.name]=c}let s={};if(t!==null&&parseInt(t)!==n.version){for(let a=0;a<this.tables.length;a++)this.tables[a]?.persist&&(s[this.tables[a].name]=[]);await new Promise(a=>{try{let o=indexedDB.open(n.name,parseInt(t));o.onsuccess=async()=>{let c=o.result;for(let l in s)s[l]=await new Promise(h=>{let u=c.transaction(l,"readonly").objectStore(l).getAll();u.onsuccess=()=>{h(u.result)}});c.close(),a()}}catch(o){console.error(o),a()}})}await new Promise(a=>{setTimeout(a,150)}),this.db=await ce(n.name,n.version,{upgrade(a,o,c,l){for(let h of a.objectStoreNames)a.deleteObjectStore(h);for(let h=0;h<n.tables.length;h++){let u=n.tables[h],f={keyPath:"id",autoIncrement:!1};u?.keyPath&&(f.keyPath=u.keyPath),typeof u.autoIncrement!="undefined"&&(f.autoIncrement=u.autoIncrement);let p=a.createObjectStore(u.name,f);for(let g=0;g<u.columns.length;g++){let b=u.columns[g];p.createIndex(b.key,b.key,{unique:b?.unique??!1})}}},blocked(){console.error("This app needs to restart. Close all tabs for this app and before relaunching.")},blocking(){console.error("This app needs to restart. Close all tabs for this app and before relaunching.")}});let r=[];for(let a in s)for(let o=0;o<s[a].length;o++)r.push(this.db.put(a,s[a][o]));return await Promise.all(r),n.version}async performQuery(e,t){let n=[];for(let s=0;s<e.length;s++){let r=e[s];t&&console.log(r);let a=[],o=!1;r.type!=="INSERT"&&r.table!=="*"&&(r.where!==null&&r.where.length===1&&r.where[0].checks.length===1&&!Array.isArray(r.where[0].checks[0])&&r.where[0].checks[0].type==="=="?(o=!0,a=await this.db.getAllFromIndex(r.table,r.where[0].checks[0].column,r.where[0].checks[0].value)):a=await this.db.getAll(r.table));let c=[];switch(r.type){case"RESET":if(r.table==="*"){let h=[];for(let u=0;u<this.tables.length;u++)h.push(this.db.clear(this.tables[u].name));await Promise.all(h)}else await this.db.clear(r.table);break;case"UPDATE":r.where!==null&&!o&&(a=this.handleWhere(r,a));for(let h=0;h<a.length;h++){let u=!1;for(let f in r.set)f==="*"?(a[h]=r.set[f],u=!0):f in a[h]&&(a[h][f]=r.set[f],u=!0);u&&c.push(this.db.put(r.table,a[h]))}await Promise.all(c);break;case"DELETE":r.where!==null&&!o&&(a=this.handleWhere(r,a));let l=this.getTableKey(r.table);for(let h=0;h<a.length;h++)c.push(this.db.delete(r.table,a[h][l]));await Promise.all(c);break;case"SELECT":r.where!==null&&!o&&(a=this.handleWhere(r,a));break;case"INSERT":for(let h of r.values){let u={...this.defaults[r.table]},f=Object.assign(u,h);await this.db.put(r.table,f)}a=r.values;break;default:break}if(r.type==="SELECT"&&(r.function!==null?a=this.handleSelectFunction(r,a):(r.uniqueOnly&&(a=this.getUnique(a,r.columns)),r.columns.length&&r.columns[0]!=="*"&&(a=this.filterColumns(r,a)),r.order!==null&&this.sort(r,a),r.limit!==null&&(a=a.splice(r.offset,r.limit)))),r.uniqueOnly){let l=[];for(let h=0;h<a.length;h++)l.push(a[h][r.columns[0]]);a=l}else r.group!==null&&(a=this.buildGroups(a,r.group));Array.isArray(a)?n=[...n,...a]:n.push(a)}return e.length===1&&e[0].group!==null&&(n=n[0]),n}buildGroups(e,t){let n={};for(let s=0;s<e.length;s++)e[s][t]in n?n[e[s][t]].push(e[s]):n[e[s][t]]=[e[s]];return n}getUnique(e,t){let n=[],s=[];for(let r=0;r<e.length;r++)s.includes(e[r][t[0]])||(s.push(e[r][t[0]]),n.push(e[r]));return n}getTableKey(e){let t="id";for(let n=0;n<this.tables.length;n++)if(this.tables[n].name===e){this.tables[n]?.keyPath&&(t=this.tables[n].keyPath);break}return t}check(e,t){let n=!1;switch(e.type){case"LIKE":new x([t],{keys:[e.column],ignoreLocation:!0,threshold:0}).search(e.value).length&&(n=!0);break;case"INCLUDES":Array.isArray(t[e.column])&&t[e.column].includes(e.value)&&(n=!0);break;case"EXCLUDES":Array.isArray(t[e.column])&&!t[e.column].includes(e.value)&&(n=!0);break;case">=":t[e.column]>=e.value&&(n=!0);break;case">":t[e.column]>e.value&&(n=!0);break;case"<=":t[e.column]<=e.value&&(n=!0);break;case"<":t[e.column]<e.value&&(n=!0);break;case"!>=":t[e.column]<e.value&&(n=!0);break;case"!>":t[e.column]<=e.value&&(n=!0);break;case"!==":t[e.column]!==e.value&&(n=!0);break;case"!=":t[e.column]!=e.value&&(n=!0);break;case"!<=":t[e.column]>e.value&&(n=!0);break;case"!<":t[e.column]>=e.value&&(n=!0);break;case"==":t[e.column]===e.value&&(n=!0);break;case"=":t[e.column]==e.value&&(n=!0);break;default:break}return n}handleWhere(e,t){let n=[];for(let s=0;s<t.length;s++){let r=t[s],a=!1;for(let o=0;o<e.where.length;o++){let c=e.where[o],l=0,h=c.checks.length;for(let u=0;u<c.checks.length;u++){let f=c.checks[u];if(Array.isArray(f)){let p=0,g=f.length;for(let b=0;b<f.length;b++)this.check(f[b],r)&&p++;p===g&&l++}else this.check(f,r)&&l++;if(l!==0&&!c.requireAll){a=!0;break}}if(a||l===h){a=!0;break}}a&&n.push(r)}return n}handleSelectFunction(e,t){let n;switch(e.function){case"MIN":let s;for(let o=0;o<t.length;o++){let c=t[o]?.[e.columns[0]]??0;(o===0||c<s)&&(s=c)}n=s;break;case"MAX":let r;for(let o=0;o<t.length;o++){let c=t[o]?.[e.columns[0]]??0;(o===0||c>r)&&(r=c)}n=r;break;case"SUM":n=0;for(let o=0;o<t.length;o++){let c=t[o]?.[e.columns[0]]??0;(isNaN(c)||!isFinite(c))&&(c=0),n+=c}break;case"AVG":let a=0;for(let o=0;o<t.length;o++){let c=t[o]?.[e.columns[0]]??0;(isNaN(c)||!isFinite(c))&&(c=0),a+=c}n=a/t.length;break;case"COUNT":n=t.length;break;default:break}return n}sort(e,t){e.order.by==="ASC"?t.sort((n,s)=>{let r=n?.[e.order.column]??0,a=s?.[e.order.column]??0;return r>=a?1:-1}):t.sort((n,s)=>{let r=n?.[e.order.column]??0,a=s?.[e.order.column]??0;return r>=a?-1:1})}filterColumns(e,t){let n=[];for(let s=0;s<t.length;s++){let r=t[s],a={};for(let o=0;o<e.columns.length;o++)a[e.columns[o]]=r?.[e.columns[o]]??null;n.push(a)}return n}buildQueryFromStatement(e,t={}){let n=this.parseSegments(e),s={uniqueOnly:!1,type:null,function:null,table:null,columns:null,offset:0,limit:null,where:null,values:null,order:null,set:null,group:null};for(let r=n.length-1;r>=0;r--){let a=n[r].join(" ");if(a.indexOf("+")!==-1||a.indexOf("/")!==-1||a.indexOf("%")!==-1)throw"Invalid syntax. Arithmetic operators are not currently supported.";if(a.indexOf("&")!==-1||a.indexOf("|")!==-1||a.indexOf("^")!==-1)throw"Invalid syntax. Bitwise operators are not currently supported.";switch(n[r][0].toUpperCase()){case"SET":s=this.parseSetSegment(n[r],s,t);break;case"VALUES":s=this.parseValues(n[r],s,t);break;case"OFFSET":if(n[r].length!==2)throw`Invalid syntax at: ${n[r].join(" ")}`;s.offset=parseInt(this.injectParameter(n[r][1],t));break;case"LIMIT":if(n[r].length!==2)throw`Invalid syntax at: ${n[r].join(" ")}`;s.limit=parseInt(this.injectParameter(n[r][1],t));break;case"GROUP":s=this.parseGroupBySegment(n[r],s,t);break;case"ORDER":s=this.parseOrderBySegment(n[r],s,t);break;case"WHERE":s=this.parseWhereSegment(n[r],s,t);break;case"FROM":if(n[r].length!==2)throw`Invalid syntax at: ${n[r].join(" ")}`;s.table=this.injectParameter(n[r][1],t);break;case"SELECT":s.type="SELECT",s=this.parseSelectSegment(n[r],s,t);break;case"DELETE":s.type="DELETE";break;case"INSERT":s.type="INSERT",s=this.parseInsertSegment(n[r],s,t);break;case"UPDATE":if(n[r].length!==2)throw`Invalid syntax at: ${n[r].join(" ")}`;s.table=this.injectParameter(n[r][1],t),s.type="UPDATE";break;case"RESET":if(n[r].length!==2)throw`Invalid syntax at: ${n[r].join(" ")}`;s.table=this.injectParameter(n[r][1],t),s.type="RESET";break;default:throw`Invalid syntax at: ${n[r].join(" ")}`}}if(s.type===null)throw"Invalid syntax: Missing SELECT, UPDATE, INSERT INTO, or DELETE statement.";if(s.table===null)throw"Invalid syntax: Missing FROM.";if(s.type==="SELECT"&&s.columns===null)throw"Invalid syntax: Missing columns.";if(s.type==="INSERT"&&s.values===null)throw"Invalid syntax: Missing VALUES.";if(s.type==="UPDATE"&&s.set===null)throw"Invalid syntax: Missing SET.";if(s.type==="UPDATE"&&s.where===null)throw"Invalid syntax: Missing WHERE.";if(isNaN(s.limit))throw"Invalid syntax: LIMIT is not a number.";if(isNaN(s.offset))throw"Invalid syntax: OFFSET is not a number.";return s.table=this.injectParameter(s.table,t),s}async buildQueriesFromSQL({sql:e,params:t}){e=e.replace(/\-\-.*|\;$/g,"").trim();let n=[],s=e.split(/\bUNION\b/i);for(let r=0;r<s.length;r++)n.push(this.buildQueryFromStatement(s[r],t));return n}parseSetSegment(e,t,n){let s={};if(e.length<2)throw`Invalid syntax at: ${e.join(" ")}.`;{t.set={},e.splice(0,1);let r=e.join(" ").trim().split(",");for(let a=0;a<r.length;a++){let o=r[a].trim().split("=");if(o.length===2)s[o[0].trim()]=o[1].trim().replace(/^[\"\']|[\"\']$/g,"");else if(o.length===1)s["*"]=o[0].trim().replace(/^[\"\']|[\"\']$/g,"");else throw`Invalid syntax at: SET ${o.join(" ")}`}}for(let r in s)t.set[this.injectParameter(r,n)]=this.injectParameter(s[r],n);return t}buildConditionCheck(e){let t;if(Array.isArray(e)){t=[];for(let n=0;n<e.length;n++){let s={column:"",type:"=",value:null};e[n]=e[n].trim().replace(/\'|\"/g,""),s.type=e[n].match(/\=|\=\=|\!\=|\!\=\=|\>|\<|\>\=|\<\=|\!\>\=|\!\<\=|\!\>|\!\<|\bLIKE\b|\bINCLUDES\b|\bEXCLUDES\b/gi).join("").trim();let r=e[n].split(s.type);s.column=r[0],s.value=r[1],t.push(s)}}else{let n={column:"",type:"=",value:null};e=e.trim().replace(/\'|\"/g,""),n.type=e.match(/\=|\=\=|\!\=|\!\=\=|\>|\<|\>\=|\<\=|\!\>\=|\!\<\=|\!\>|\!\<|\bLIKE\b|\bINCLUDES\b|\bEXCLUDES\b/gi).join("").trim();let s=e.split(n.type);n.column=s[0].trim(),n.value=s[1].trim(),t=n}return t}buildConditions(e){let t={requireAll:!0,checks:[]},n=[];if(e.search(/\bOR\b/i)!==-1){t.requireAll=!1,n=e.split(/\bOR\b/i);for(let s=0;s<n.length;s++)n[s].search(/\bAND\b/i)!==-1&&n.splice(s,1,n[s].split(/\bAND\b/i))}else n=e.split(/\bAND\b/i);for(let s=0;s<n.length;s++)t.checks.push(this.buildConditionCheck(n[s]));return t}parseWhereSegment(e,t,n){if(e.length<2)throw`Invalid syntax at: ${e.join(" ")}.`;{t.where=[],e.splice(0,1);let s=[],r=0;for(let o=e.length-1;o>=0;o--){let c=-1;switch(r+=(e[o].match(/\)/g)||[]).length,r-=(e[o].match(/\(/g)||[]).length,e[o].toUpperCase()){case"OR":r===0&&(c=o);break;default:break}c!==-1?s.push(e.splice(c,e.length)):o===0&&s.push(e.splice(0,e.length))}s.reverse();for(let o=0;o<s.length;o++)s[o][0].toUpperCase()==="OR"&&s[o].splice(0,1);for(let o=0;o<s.length;o++){let c=s[o].join(" ");c=c.trim().replace(/^\(|\)$/g,"").trim(),s.splice(o,1,c)}let a=[];for(let o=0;o<s.length;o++){let c=this.buildConditions(s[o]);a.push(c)}t.where=a;for(let o=0;o<t.where.length;o++)for(let c=0;c<t.where[o].checks.length;c++)if(Array.isArray(t.where[o].checks[c]))for(let l=0;l<t.where[o].checks[c].length;l++){let h=t.where[o].checks[c][l];t.where[o].checks[c][l].value=this.injectParameter(h.value,n),t.where[o].checks[c][l].column=this.injectParameter(h.column,n)}else{let l=t.where[o].checks[c];t.where[o].checks[c].value=this.injectParameter(l.value,n),t.where[o].checks[c].column=this.injectParameter(l.column,n)}return t}}parseGroupBySegment(e,t,n){if(e.length!==3)throw"Invalid syntax. GROUP BY only currently supports single column sorting.";if(t.uniqueOnly)throw"Invalid syntax. GROUP BY can not be used with UNIQUE or DISTINCT statements.";return t.group=this.injectParameter(e[2],n),t}parseOrderBySegment(e,t,n){if(e.length<3||e[1]!=="BY")throw`Invalid syntax at: ${e.join(" ")}.`;if(e.splice(0,2),e.length>2||e[0].indexOf(",")!==-1)throw"Invalid syntax. ORDER BY only currently supports single column sorting.";{let s="ASC";if(e?.[1]&&(s=e[1].toUpperCase(),s!=="ASC"&&s!=="DESC"))throw"Invalid syntax. ORDER BY only currently supports ASC or DESC sorting.";t.order={column:this.injectParameter(e[0],n),by:s}}return t}parseValues(e,t,n){if(e.length===1)throw`Invalid syntax at: ${e}.`;{t.values=[],e.splice(0,1);let s=e.join("").match(/(?<=\().*?(?=\))/g)||[];for(let r=0;r<s.length;r++){let a=s[r].split(","),o={...this.defaults[t.table]};if(a.length===1&&a[0].trim().indexOf("$")===0)o=Object.assign(o,this.injectParameter(a[r],n)),t.values.push(o);else if(a.length>=1){let c=0;for(let l in o){if(c>=a.length)break;o[l]=this.injectParameter(a[c],n),c++}t.values.push(o)}else throw`Invalid syntax. VALUE error at ${s[r]}`}}return t}injectParameter(e,t){if(e.toString().indexOf("$")===0){let n=e.substring(1,e.length);if(n in t)return t[n];throw`Invalid params. Missing key: ${n}`}else typeof e=="string"&&(e=e.replace(/\[|\]/g,"").trim());return e}parseInsertSegment(e,t,n){if(e.length<3||e[1]!=="INTO")throw`Invalid syntax at: ${e.join(" ")}.`;if(e.length===3)t.table=this.injectParameter(e[2],n);else throw"Invalid syntax. Only 'INSERT INTO table_name' queries are currently supported.";return t}parseSelectSegment(e,t,n){if(e.includes("*")&&(t.columns=["*"]),e[1].toUpperCase()==="DISTINCT"||e[1].toUpperCase()==="UNIQUE"){if(e.includes("*"))throw"Invalid SELECT statement. DISTINCT or UNIQUE does not currently support the wildcard (*) character.";if(t.uniqueOnly=!0,e.splice(1,1),e.length>2)throw"Invalid SELECT statement. DISTINCT or UNIQUE does not currently support multiple columns."}else if(e[1].toUpperCase().search(/\bCOUNT\b/i)===0||e[1].toUpperCase().search(/\bMIN\b/i)===0||e[1].toUpperCase().search(/\bMAX\b/i)===0||e[1].toUpperCase().search(/\bAVG\b/i)===0||e[1].toUpperCase().search(/\bSUM\b/i)===0){if(e.includes("*"))throw"Invalid SELECT statement. Functions can not be used with the wildcard (*) character.";let s=e[1].match(/\w+/)[0].trim().toUpperCase(),r=e[1].match(/\(.*?\)/)[0].replace(/\(|\)/g,"").trim();t.function=s,t.columns=[this.injectParameter(r,n)]}if(t.columns===null){if(e.length===1)throw"Invalid SELECT statement syntax.";t.columns=[];for(let s=1;s<e.length;s++){let r=e[s].split(",");for(let a=0;a<r.length;a++){let o=r[a].trim();o.length&&t.columns.push(this.injectParameter(o,n))}}}return t}parseSegments(e){let t=e.trim().split(/\s+/),n=[];for(;t.length>0;){let s=-1;for(let r=t.length-1;r>=0;r--){switch(t[r].toUpperCase()){case"HAVING":throw"Invalid syntax: HAVING clause is not currently supported.";case"UNION":throw"Invalid syntax: UNION operator is not currently supported.";case"JOIN":throw"Invalid syntax: JOIN clause is not currently supported.";case"SET":s=r;break;case"VALUES":s=r;break;case"OFFSET":s=r;break;case"LIMIT":s=r;break;case"ORDER":s=r;break;case"WHERE":s=r;break;case"FROM":s=r;break;case"SELECT":s=r;break;case"DELETE":s=r;break;case"INSERT":s=r;break;case"UPDATE":s=r;break;case"RESET":s=r;break;case"GROUP":s=r;break;default:break}if(s!==-1)break}if(s===-1&&t.length>0)throw`Invalid syntax: ${e}`;n.push(t.splice(s,t.length))}return n}};new Te;})();